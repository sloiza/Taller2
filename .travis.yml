# language:
#   - cpp
# compiler:
# #  - clang
#   - gcc
sudo: false
language: cpp
compiler: gcc
addons:
    apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - gcc-multilib
          - gcc-5
          - g++-5
          - gcc-5-locales
          - gcc-5-multilib
          - g++-5-multilib
          - libstdc++6-5-dbg
          - lib32stdc++6-5-dbg
          - libstdc++-5-doc
          - libgcc1-dbg
          - libgomp1-dbg
          - libitm1-dbg
          - libatomic1-dbg
          - libasan2-dbg
          - liblsan0-dbg
          - libtsan0-dbg
          - libubsan0-dbg
          - libcilkrts5-dbg
          - libquadmath0-dbg
          - zlib1g-dev
          - libbz2-dev
          - libsnappy-dev

before_install:
  - mkdir -p root/bin root/usr/bin root/usr/lib root/usr/include
  - export PATH=`pwd`/root/bin:`pwd`/root/usr/bin:`pwd`/root/usr/local/bin:$PATH
  - export LIBRARY_PATH=`pwd`/root/usr/lib64:`pwd`/root/usr/local/lib64:`pwd`/root/usr/lib:`pwd`/root/usr/local/lib:$LIBRARY_PATH
  - export LD_LIBRARY_PATH=`pwd`/root/usr/lib64:`pwd`/root/usr/local/lib64:`pwd`/root/usr/lib:`pwd`/root/usr/local/lib:$LD_LIBRARY_PATH
  - export CPATH=`pwd`/root/usr/include:`pwd`/root/usr/local/include:$CPATH
  - ln -s /usr/bin/gcc-5 `pwd`/root/usr/bin/gcc
  - ln -s /usr/bin/g++-5 `pwd`/root/usr/bin/g++
  - export CXX=`pwd`/root/usr/bin/g++
  - export CC=`pwd`/root/usr/bin/gcc
#  - sudo apt-get update -qq
   - sudo apt-get -y install software-properties-common
#   - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
   - sudo add-apt-repository -y ppa:george-edison55/cmake-3.x
   - sudo add-apt-repository -y ppa:fkrull/deadsnakes
   - sudo apt-get update
   - sudo apt-get install -y -qq gcc-5 g++-4.9 clang-3.5 libgtest-dev
   # zlib1g-dev libbz2-dev libsnappy-dev
   - sudo apt-get install -y wget cmake unzip python-pip python2.7 libgtest-dev lcov
   - sudo pip install cpp-coveralls
install:
  - wget https://gflags.googlecode.com/files/libgflags0_2.0-1_amd64.deb
  - dpkg-deb -x libgflags0_2.0-1_amd64.deb `pwd`/root/
  - wget https://gflags.googlecode.com/files/libgflags-dev_2.0-1_amd64.deb
  - dpkg-deb -x libgflags-dev_2.0-1_amd64.deb `pwd`/root/
  - wget https://github.com/NickCis/rocksdb/releases/download/deb-new/rocksdb_3.10-0.deb
  - dpkg-deb -x rocksdb_3.10-0.deb `pwd`/root/
   - export CXX="g++-4.9"
   - g++ --version

before_script:
   - HOME=`pwd`
   # - wget https://github.com/NickCis/rocksdb/archive/master.zip
   # - unzip master.zip
   # - cd rocksdb-master
   # - make static_lib
   # - make shared_lib
   # - sudo make install
   # - "cd ../ && sudo rm master.zip"
   - sudo ln -s /usr/local/bin/g++-5 /usr/local/bin/g++
   - "cd /usr/src/gtest && sudo cmake . && sudo cmake --build . && sudo mv libg* /usr/local/lib/ ; cd -"
   - cd $HOME
   - mkdir servidor/build
script: 
  - "cd servidor/build && cmake -DINCLUIR_TEST=ON .. && make && make test"

after_success:
  - coveralls --exclude lib --exclude tests --gcov-options '\-lp'

